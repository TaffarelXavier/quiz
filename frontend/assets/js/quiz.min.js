$(document).ready(function(){function e(e,a){return e=Math.ceil(e),a=Math.floor(a),Math.floor(Math.random()*(a-e+1))+e}var a=$(".js-example-basic-single");const t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u"];SubCategoria.all(e=>{let t=e.map(({sub_categoria_id:e,sub_titulo:a})=>({id:e,text:a}));a.select2({data:t})}),$("#criar-categoria").submit(e=>(Categoria.store(this.forms[0].elements1),!1)),$("#criar-sub-categoria").submit(e=>(SubCategoria.store(this.forms[1].elements),!1)),$("#form-criar-quiz").submit(e=>{var t=a.select2("data"),r=document.querySelector("#form-criar-quiz");return Quiz.store({form:r,data:t},e=>{const{quiz_id:a}=e;window.location.href="?quiz_id="+a}),!1});const r=()=>{let e=Object.values($(".alternativa")).filter(e=>e.name),a=t[e.length];var r=`<label><input type="radio" name="alter-correta" required/>Alternativa ${a.toUpperCase()}:</label>\n    <textarea class="form-control alternativa" rows="3" placeholder="Digite o texto da alternativa ${a}" name="${a}" required=""></textarea>`;$("#obter-mais-questoes").append(r)},o=({quiz_id:e})=>`<form method="POST" id="form-criar-questao">\n        <h3><strong>Nova Questão</strong><button type="button" id="add-from-external-text">add</button></h3>\n        <label>Enuciado:</label>\n        <textarea class="form-control" placeholder="Adicione o enunciado da questão"\n        required name="enunciado" rows="6"></textarea>\n        <label><input type="radio" name="alter-correta" required/>Alternativa A:</label>\n        <input type="hidden" name="quiz_id" value="${e}"/>\n        <textarea class="form-control alternativa" rows="3" placeholder="Digite o texto da alternativa a" name="a" required=""></textarea>\n        <!--<label><input type="radio" name="alter-correta" required/>Alternativa B:</label>\n        <textarea class="form-control alternativa" rows="3" placeholder="Digite o texto da alternativa b" name="b" required=""></textarea>-->\n        <div id="obter-mais-questoes"></div><br/>\n        <label>Modalidade:</label><br/>\n        <select name="modalidade" id="modalidade_id" class="form-control" required>\n          <option value="">Selecione...</option> \n          <option value="1" selected="selected">Múltipa-escolha</option> \n          <option value="0">Verdadeiro-Falso</option> \n        </select><br/>\n        <label>Correção da questão:</label>\n        <textarea class="form-control explicacao" rows="3" placeholder="Explicação da questão"></textarea>\n        <br>\n        <button id="btn-add-questao" class="btn btn-raised btn-primary" type="button">Add Alternativa</button>\n        <button type="submit" class="btn btn-raised btn-primary">Salvar Questão</button></form>`,n=({questao_id:a,questao_enunciado:r,questao_modalidade:o,alternativas:n,questao_correcao:i,incremento:l},s)=>{let c=void 0===r?"Nome do Quiz":"<pre class='questao-enunciado'>"+r+"</pre>",d=`<details open id="questao_${a}">\n  <summary style='padding:10px !important;margin:0px;background:rgba(241,243,245,0.94)'>\n      <strong>${l} > ${s} </strong>\n  </summary>\n  <summary style='padding:0px !important;margin:0px;'>\n  <strong>${c}</strong></summary><hr/>`;n=n.sort(function(e,a){return.5-Math.random()});let u=n.map(({alternativa_resposta:r,alternativa_correta:n},i)=>{if("1"===o){var l=t[i],s="",c=e(0,255),d=e(0,255),u=e(0,255),m=`rgba(${c},${d},${u},0.1)`;return s+=1===n?`<div class="col-md-12"><p class="multipla-escolha certa" style="background:${m}" data-questao-id="${a}"\n            data-questao-correta="${n}">\n           <span class="letra-enuc">${l.toUpperCase()}</span> ${r}</p></div>`:`<div class="col-md-12"><p class="multipla-escolha errada" style="background:${m}"  data-questao-id="${a}"\n            data-questao-correta="${n}">\n            <span class="letra-enuc">${l.toUpperCase()}</span> ${r}</p></div>`,s}let b='<div class="col-md-6">';return b+="1"==r?`<button class="verdadeiro-falso certo col-md-12" data-questao-id="${a}"\n          data-questao-correta="${n}">Verdade</button>`:`<button class="verdadeiro-falso errado col-md-12" data-questao-id="${a}"\n          data-questao-correta="${n}">Falso</button>`,b+="</div>",b});return d+=`<div class="row">${u.join("")}</div></div>`,null!=i&&(d+=`<p id="correcao_${a}" hidden><br/><strong>Correção:</strong>\n        <i>${i}</i></p>`),d+=`<p id="explicacao_${a}" class="explicacao" hidden></p>`,d+="</details><hr style='margin-bottom:30px;margin-top:30px;'/>",d},i=()=>{let e=new URL(window.location).searchParams,a=e.get("quiz_id"),t=e.get("flashcard");null!==a?Quiz.getByQuizId(a,e=>{let{quiz_id:a,titulo:i,questoes:l}=e[0],s="";if(Boolean(t)&&"true"==t)flashCard(e[0]),t&&$("#get-inserir-quiz").hide();else{s=`<br/><h3><strong>Suas Questões</strong> - \n          <a class="btn btn-raised btn-primary" href='?quiz_id=${a}&flashcard=true'>FlashCards</a>\n          <a href="">Atualizar</a>\n          </h3>`,l=l.sort((e,a)=>.5-Math.random());var c=0;for(let e of l)c++,e.incremento=c,s+=n(e,i);s+='<a href="">Responder Novamente</a>',$("#get-questoes").html(s),$(".verdadeiro-falso").click(function(){var e=$(this),a=e.attr("data-questao-correta"),t=e.attr("data-questao-id"),r=$(`#questao_${t}`);let o="rgba(229,58,5,0.8)",n="#2e7d32";"1"==a?$("#explicacao_"+t).html("Parabéns! Você acertou!").removeAttr("hidden").css({color:"#23be87"}):$("#explicacao_"+t).html("Você errou!!!").removeAttr("hidden").css({color:"red"}),"1"==a&&e.attr("class").includes("certo")?(r.find(".errado").css({background:o,color:"white"}),r.find(".certo").css({background:n,color:"white"})):"0"==a&&e.attr("class").includes("certo")?(r.find(".errado").css({background:n,color:"white"}),r.find(".certo").css({background:o,color:"white"})):"1"==a&&e.attr("class").includes("errado")?(r.find(".errado").css({background:n,color:"white"}),r.find(".certo").css({background:o,color:"white"})):"0"==a&&e.attr("class").includes("errado")&&(r.find(".errado").css({background:o,color:"white"}),r.find(".certo").css({background:n,color:"white"})),$(`#correcao_${t}`).removeAttr("hidden")}),$(".multipla-escolha").click(function(){var e=$(this),a=e.attr("data-questao-correta"),t=e.attr("data-questao-id"),r=$(`#questao_${t}`);let o="rgba(208,29,29,0.94)",n="#2e7d32";"1"===a?($("#explicacao_"+t).html("Parabéns! Você acertou!").removeAttr("hidden").css({color:"#23be87"}),r.find(".errada").css({background:o,color:"white"}),e.css({background:n,color:"white"})):(r.find(".errada").css({background:o,color:"white"}),r.find(".certa").css({background:n,color:"white"}),e.css({background:o,border:"2px dashed black"}),$("#explicacao_"+t).html("Você errou!!!").removeAttr("hidden").css({color:"red"})),$(`#correcao_${t}`).html("Voce errou!!!").removeAttr("hidden")});var d=`<label>Nome do Quiz:</label>\n          <h3>${i}</h3><hr/>${o({quiz_id:a})}`;function u(e,a){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=a;else if(e.selectionStart||"0"==e.selectionStart){var t=e.selectionStart,r=e.selectionEnd;e.value=e.value.substring(0,t)+a+e.value.substring(r,e.value.length)}else e.value+=a}$("#get-inserir-quiz").html(d);const e=document.getElementsByName("enunciado");function m(e){try{var a=e;setTimeout(function(){if(console.log("adfad"),a.length>0&&a.includes("taffa")){let i=a.split("taffa"),l=i[0],s=i[1];document.getElementsByName("enunciado")[0].value=l;var e=s.split("\n");e=e.filter(e=>!!(e.length>0&&e.match(/^a|b|c|d|e|f|g|h|\)|\s+$/gm))&&e);for(var t=e.length,o=0;o<t-1;o++)r();var n=document.getElementsByClassName("alternativa");for(o=0;o<t;o++)n[o].value=e[o]}},200)}catch(e){alert(e)}}e[0].onkeyup=function(e){},$("#add-from-external-text").click(function(){u(e[0],"taffa"),m(e[0].value)}),$("#modalidade_id").change(function(){var e=this.selectedIndex;2==e&&r()}),$("#btn-add-questao").click(()=>{r()}),$("#form-criar-questao").submit(function(){var e=this;let a=Object.values($(".alternativa")).filter(e=>{if("object"==typeof e)return e.value});return a=a.map((e,a)=>{var t=document.getElementsByName("alter-correta")[a];return{alternativa_letra:e.name,alternativa_resposta:e.value,alternativa_correta:t.checked,questao_id:null}}),Questao.store(e.elements,a,e=>{console.log(e)}),!1})}}):Quiz.all(function(e){e=e.map(e=>`<a href="?quiz_id=${e.quiz_id}">${e.titulo}</a> | \n          <a href="?quiz_id=${e.quiz_id}&flashcard=true">FlashCards</a><br/>`),$("#get-questoes").html(e.join("")),$("#get-inserir-quiz").html("")})};i()});