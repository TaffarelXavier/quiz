$(document).ready((function(){var eventSelect=$(".js-example-basic-single");function getRandomIntInclusive(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min}const ALFABETO=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u"];SubCategoria.all(result=>{let data=result.map(({sub_categoria_id:sub_categoria_id,sub_titulo:sub_titulo})=>({id:sub_categoria_id,text:sub_titulo}));eventSelect.select2({data:data})}),$("#criar-categoria").submit(ev=>(Categoria.store(this.forms[0].elements1),!1)),$("#criar-sub-categoria").submit(ev=>(SubCategoria.store(this.forms[1].elements),!1)),$("#form-criar-quiz").submit(ev=>{var data=eventSelect.select2("data"),form=document.querySelector("#form-criar-quiz");return Quiz.store({form:form,data:data},result=>{const{quiz_id:quiz_id}=result;window.location.href="?quiz_id="+quiz_id}),!1});const novaQuestao=()=>{let alternativas=Object.values($(".alternativa")).filter(el=>el.name),letra=ALFABETO[alternativas.length];var conteudo=`<label><input type="radio" name="alter-correta" required/>Alternativa ${letra.toUpperCase()}:</label>\n    <textarea class="form-control alternativa" rows="3" placeholder="Digite o texto da alternativa ${letra}" name="${letra}" required=""></textarea>`;$("#obter-mais-questoes").append(conteudo)},formCriarQuestao=({quiz_id:quiz_id})=>`<form method="POST" id="form-criar-questao">\n        <label>Enuciado:</label>\n        <textarea class="form-control" placeholder="Adicione o enunciado da questão"\n        required name="enunciado" rows="6"></textarea>\n        <button type="button" id="add-from-external-text">Adicionar questão de texto</button><br>\n        <label><input type="radio" name="alter-correta" required/>Alternativa A:</label>\n        <input type="hidden" name="quiz_id" value="${quiz_id}"/>\n        <textarea class="form-control alternativa" rows="3" placeholder="Digite o texto da alternativa a" name="a" required=""></textarea>\n        <div id="obter-mais-questoes"></div>\n        <button id="btn-add-questao" class="btn btn-raised btn-primary" type="button">Adicionar outro campo de alternativa</button><br/>\n        <label>Modalidade:</label><br/>\n        <select name="modalidade" id="modalidade_id" class="form-control" required>\n          <option value="">Selecione...</option> \n          <option value="1" selected="selected">Múltipa-escolha</option> \n          <option value="0">Verdadeiro-Falso</option> \n        </select><br/>\n        <label>Correção da questão:</label>\n        <textarea class="form-control explicacao" rows="3" placeholder="Explicação da questão"></textarea>\n        <br>\n        <button type="submit" class="btn btn-raised btn-primary btn-lg ">Salvar Questão</button></form>`,questaoDetalhe=({questao_id:questao_id,questao_enunciado:questao_enunciado,questao_modalidade:questao_modalidade,alternativas:alternativas,questao_correcao:questao_correcao,incremento:incremento},titulo)=>{let enunciado,conteudo=`<details open id="questao_${questao_id}">\n  <summary style='padding:10px !important;margin:0px;background:rgba(241,243,245,0.94)'>\n      <strong>${incremento} > ${titulo} </strong>\n  </summary>\n  <summary style='padding:0px !important;margin:0px;'>\n  <strong>${void 0===questao_enunciado?"Nome do Quiz":"<pre class='questao-enunciado'>"+questao_enunciado+"</pre>"}</strong></summary><hr/>`,alt;return conteudo+=`<div class="row">${(alternativas=alternativas.sort((function(a,b){return.5-Math.random()}))).map(({alternativa_resposta:alternativa_resposta,alternativa_correta:alternativa_correta},index)=>{if("1"===questao_modalidade){var letra=ALFABETO[index],_data="",red,green,blue,bgColor=`rgba(${getRandomIntInclusive(0,255)},${getRandomIntInclusive(0,255)},${getRandomIntInclusive(0,255)},0.1)`;return _data+=1===alternativa_correta?`<div class="col-md-12"><p class="multipla-escolha certa" style="background:${bgColor}" data-questao-id="${questao_id}"\n            data-questao-correta="${alternativa_correta}">\n           <span class="letra-enuc">${letra.toUpperCase()}</span> ${alternativa_resposta}</p></div>`:`<div class="col-md-12"><p class="multipla-escolha errada" style="background:${bgColor}"  data-questao-id="${questao_id}"\n            data-questao-correta="${alternativa_correta}">\n            <span class="letra-enuc">${letra.toUpperCase()}</span> ${alternativa_resposta}</p></div>`}let data='<div class="col-md-6">';return data+="1"==alternativa_resposta?`<button class="verdadeiro-falso certo col-md-12" data-questao-id="${questao_id}"\n          data-questao-correta="${alternativa_correta}">Certo</button>`:`<button class="verdadeiro-falso errado col-md-12" data-questao-id="${questao_id}"\n          data-questao-correta="${alternativa_correta}">Errado</button>`,data+="</div>"}).join("")}</div></div>`,null!=questao_correcao&&(conteudo+=`<p id="correcao_${questao_id}" hidden><br/><strong>Correção:</strong>\n        <i>${questao_correcao}</i></p>`),conteudo+=`<p id="explicacao_${questao_id}" class="explicacao" hidden></p>`,conteudo+="</details><hr style='margin-bottom:30px;margin-top:30px;'/>"},carregarDados=()=>{let params=new URL(window.location).searchParams,quiz_id=params.get("quiz_id"),_flashCard=params.get("flashcard");null!==quiz_id?Quiz.getByQuizId(quiz_id,result=>{let{quiz_id:quiz_id,titulo:titulo,questoes:questoes}=result[0],conteudoQuestoes="";if($("#titulo-do-quiz").html(`Questões sobre: ${titulo}`),Boolean(_flashCard)&&"true"==_flashCard)flashCard(result[0]),_flashCard&&$("#get-inserir-quiz").hide();else{conteudoQuestoes=`<br/><h3><strong>Suas Questões</strong> - \n          <a class="btn btn-raised btn-primary" href='?quiz_id=${quiz_id}&flashcard=true'>FlashCards</a>\n          <a href="">Atualizar</a>\n          </h3>`,questoes=questoes.sort((a,b)=>.5-Math.random());var incremento=0;for(let data of questoes)incremento++,data.incremento=incremento,conteudoQuestoes+=questaoDetalhe(data,titulo);conteudoQuestoes+='<a href="">Responder Novamente</a>',$("#get-questoes").html(conteudoQuestoes),$(".verdadeiro-falso").click((function(){var _this=$(this),resposta=_this.attr("data-questao-correta"),questaoId=_this.attr("data-questao-id"),questao=$(`#questao_${questaoId}`);let red="rgba(229,58,5,0.8)",green="#2e7d32";"1"==resposta?$("#explicacao_"+questaoId).html("Parabéns! Você acertou!").removeAttr("hidden").css({color:"#23be87"}):$("#explicacao_"+questaoId).html("Você errou!!!").removeAttr("hidden").css({color:"red"}),"1"==resposta&&_this.attr("class").includes("certo")?(questao.find(".errado").css({background:red,color:"white"}),questao.find(".certo").css({background:green,color:"white"})):"0"==resposta&&_this.attr("class").includes("certo")?(questao.find(".errado").css({background:green,color:"white"}),questao.find(".certo").css({background:red,color:"white"})):"1"==resposta&&_this.attr("class").includes("errado")?(questao.find(".errado").css({background:green,color:"white"}),questao.find(".certo").css({background:red,color:"white"})):"0"==resposta&&_this.attr("class").includes("errado")&&(questao.find(".errado").css({background:red,color:"white"}),questao.find(".certo").css({background:green,color:"white"})),$(`#correcao_${questaoId}`).removeAttr("hidden")})),$(".multipla-escolha").click((function(){var _this=$(this),questaoCorreta=_this.attr("data-questao-correta"),questaoId=_this.attr("data-questao-id"),questao=$(`#questao_${questaoId}`);let red="rgba(208,29,29,0.94)",green="#2e7d32";"1"===questaoCorreta?($("#explicacao_"+questaoId).html("Parabéns! Você acertou!").removeAttr("hidden").css({color:"#23be87"}),questao.find(".errada").css({background:red,color:"white"}),_this.css({background:green,color:"white"})):(questao.find(".errada").css({background:red,color:"white"}),questao.find(".certa").css({background:green,color:"white"}),_this.css({background:red,border:"2px dashed black"}),$("#explicacao_"+questaoId).html("Você errou!!!").removeAttr("hidden").css({color:"red"})),$(`#correcao_${questaoId}`).html("Voce errou!!!").removeAttr("hidden")}));var conteudo=`\x3c!--<label>Nome do Quiz:</label>\n          <h3>${titulo}</h3><hr/>--\x3e${formCriarQuestao({quiz_id:quiz_id})}`;function insertAtCursor(myField,myValue){if(document.selection)myField.focus(),sel=document.selection.createRange(),sel.text=myValue;else if(myField.selectionStart||"0"==myField.selectionStart){var startPos=myField.selectionStart,endPos=myField.selectionEnd;myField.value=myField.value.substring(0,startPos)+myValue+myField.value.substring(endPos,myField.value.length)}else myField.value+=myValue}$("#get-inserir-quiz").html(conteudo);const enunciadoEl=document.getElementsByName("enunciado");function copiarQuestaoExterna(texto){try{var str=texto;setTimeout((function(){if(str.length>0&&str.includes("fff")){let m=str.split("fff");m=m.filter(el=>el);const regex=/^\(?[a-zA-Z0-9]+\)/gim;let enuciado=m[0].replace(regex,"").trim(),alternativas=m[1];document.getElementsByName("enunciado")[0].value=enuciado;for(var questao=alternativas.split("\n"),quantLinhas=(questao=questao.filter(el=>!!el.match(regex)&&el)).length,i=0;i<quantLinhas-1;i++)novaQuestao();for(var alternativaEl=document.getElementsByClassName("alternativa"),i=0;i<quantLinhas;i++)alternativaEl[i].value=questao[i].replace(regex,"").trim()}}),200)}catch(error){alert(error)}}$("#add-from-external-text").click((function(){insertAtCursor(enunciadoEl[0],"taffa"),copiarQuestaoExterna(enunciadoEl[0].value)})),$("#modalidade_id").change((function(){var index;2==this.selectedIndex&&novaQuestao()})),$("#btn-add-questao").click(()=>{novaQuestao()}),$("#form-criar-questao").submit((function(){var form=this;let alternativas=Object.values($(".alternativa")).filter(el=>{if("object"==typeof el)return el.value});return alternativas=alternativas.map((el,index)=>{var alterCorreta=document.getElementsByName("alter-correta")[index];return{alternativa_letra:el.name,alternativa_resposta:el.value,alternativa_correta:alterCorreta.checked,questao_id:null}}),Questao.store(this.elements,alternativas,res=>{void 0!==res.questao_enunciado&&(alert("Questão adicionada com sucesso!"),window.location.reload())}),!1}))}}):Quiz.all((function(result){result=result.map(el=>`<a href="?quiz_id=${el.quiz_id}">${el.titulo}</a> | \n          <a href="?quiz_id=${el.quiz_id}&flashcard=true">FlashCards</a><br/>`),$("#get-questoes").html(result.join("")),$("#get-inserir-quiz").html("")}))};carregarDados()}));